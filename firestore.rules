rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection: Allow authenticated users to read/write their own data
    // Allow admin panel to read all users (no auth required for admin operations)
    match /users/{userId} {
      // Regular users can only access their own document
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Allow read access for admin operations (admin panel uses password auth, not Firebase Auth)
      // This enables the admin dashboard to fetch user data
      allow read: if true;
      
      // Allow admin write operations (for user status updates)
      allow write: if true;
    }

    // Payments collection: Allow admin panel full access
    // Since admin panel uses password authentication, we allow broader access
    match /payments/{paymentId} {
      // Allow full access for admin operations
      allow read, write: if true;
      
      // Users can read their own payment records if authenticated
      allow read: if request.auth != null && 
                     request.auth.uid == resource.data.userId;
    }

    // Admin data collection (if needed for admin-specific data)
    match /adminData/{docId} {
      // Allow admin panel access
      allow read, write: if true;
    }

    // User activity logs (if you want to track admin actions)
    match /userLogs/{logId} {
      // Allow admin panel to create logs
      allow read, write: if true;
    }

    // Optional: Admin settings collection
    match /adminSettings/{settingId} {
      // Allow admin panel to manage settings
      allow read, write: if true;
    }

    // Optional: System notifications collection
    match /notifications/{notificationId} {
      // Allow admin to manage notifications
      allow read, write: if true;
      
      // Users can read notifications addressed to them
      allow read: if request.auth != null && 
                     request.auth.uid == resource.data.userId;
    }
  }
}